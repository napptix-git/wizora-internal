(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(e){if(e.ep)return;e.ep=!0;const s=n(e);fetch(e.href,s)}})();var L=["1","2","3","4","5","kitkat"],o=[],f=9,p=7,g,v=0,b=30,E=!1,u,c,S,$,x,I;window.onload=function(){document.querySelector(".play-button").addEventListener("click",B),T()};function T(){let t=document.getElementById("board"),a=t.clientWidth,n=t.clientHeight;g=Math.min(a/p,n/f),t.style.width=`${p*g}px`,t.style.height=`${f*g}px`}function B(){E||(E=!0,v=0,b=30,document.getElementById("score").innerText=v,document.getElementById("timer").innerText=b+"s",document.getElementById("board").innerHTML="",o=[],document.querySelector(".play-button").style.display="none",D(),M(),setInterval(async()=>{let t=!0;for(;t;)t=await R(),t&&(await j(),await F())},400))}function M(){let t=setInterval(()=>{b>0?(b--,document.getElementById("timer").innerText=b+"s"):(clearInterval(t),alert("Time's up! Your final score is: "+v),E=!1,document.querySelector(".play-button").style.display="block")},1e3)}function D(){var a,n,r,e,s,i;T();let t=document.getElementById("board");for(let d=0;d<f;d++){let m=[];for(let y=0;y<p;y++){let l=document.createElement("img");l.id=d+"-"+y,l.style.width=`${g}px`,l.style.height=`${g}px`;let h;do h=w();while(y>=2&&((a=m[y-1])==null?void 0:a.dataset.type)===h&&((n=m[y-2])==null?void 0:n.dataset.type)===h||d>=2&&((e=(r=o[d-1])==null?void 0:r[y])==null?void 0:e.dataset.type)===h&&((i=(s=o[d-2])==null?void 0:s[y])==null?void 0:i.dataset.type)===h);l.src="./assets/"+h+".png",l.dataset.type=h,l.addEventListener("dragstart",O),l.addEventListener("dragover",C),l.addEventListener("dragenter",Y),l.addEventListener("dragleave",q),l.addEventListener("drop",z),l.addEventListener("dragend",A),l.addEventListener("touchstart",N),l.addEventListener("touchmove",H),l.addEventListener("touchend",X),t.append(l),m.push(l)}o.push(m)}}function w(){return L[Math.floor(Math.random()*L.length)]}function O(){u=this}function C(t){t.preventDefault()}function Y(t){t.preventDefault()}function q(){}function z(){c=this}function A(){!u||!c||u.src.includes("blank")||c.src.includes("blank")||k(u,c)&&P(u,c)}function N(t){u=t.target,S=t.touches[0].clientX,$=t.touches[0].clientY}function H(t){x=t.touches[0].clientX,I=t.touches[0].clientY}function X(){if(!u)return;let t=x-S,a=I-$,n=Math.abs(t),r=Math.abs(a),e=parseInt(u.id.split("-")[0]),s=parseInt(u.id.split("-")[1]);n>r&&n>20?t>0&&s<p-1?c=o[e][s+1]:t<0&&s>0&&(c=o[e][s-1]):r>n&&r>20&&(a>0&&e<f-1?c=o[e+1][s]:a<0&&e>0&&(c=o[e-1][s])),c&&k(u,c)&&P(u,c)}function k(t,a){let[n,r]=t.id.split("-").map(Number),[e,s]=a.id.split("-").map(Number),i=Math.abs(n-e),d=Math.abs(r-s);return i===1&&d===0||i===0&&d===1}function P(t,a){if(!t||!a)return;t.style.transition="transform 0.25s cubic-bezier(0.68, -0.55, 0.27, 1.55)",a.style.transition="transform 0.25s cubic-bezier(0.68, -0.55, 0.27, 1.55)";let n=t.getBoundingClientRect(),r=a.getBoundingClientRect();return t.style.transform=`translate(${r.left-n.left}px, ${r.top-n.top}px)`,a.style.transform=`translate(${n.left-r.left}px, ${n.top-r.top}px)`,new Promise(e=>{setTimeout(()=>{let s=t.src,i=t.dataset.type;t.src=a.src,a.src=s,t.dataset.type=a.dataset.type,a.dataset.type=i,t.style.transition="",a.style.transition="",t.style.transform="",a.style.transform="",e()},250)})}async function R(){let t=[];for(let n=0;n<f;n++)for(let r=0;r<p-2;r++){let e=o[n][r],s=o[n][r+1],i=o[n][r+2];e.src===s.src&&s.src===i.src&&!e.src.includes("blank")&&(t.push(e,s,i),v+=30)}for(let n=0;n<p;n++)for(let r=0;r<f-2;r++){let e=o[r][n],s=o[r+1][n],i=o[r+2][n];e.src===s.src&&s.src===i.src&&!e.src.includes("blank")&&(t.push(e,s,i),v+=30)}if(t.length===0)return!1;let a=[];return t.forEach(n=>{n.classList.add("puff-out"),a.push(new Promise(r=>{n.addEventListener("animationend",()=>{n.src="./assets/blank.png",n.dataset.type="blank",n.classList.remove("puff-out"),r()},{once:!0})}))}),document.getElementById("score").innerText=v,await Promise.all(a),!0}async function j(){let t=[];for(let a=0;a<p;a++){let n=0;for(let r=f-1;r>=0;r--){let e=o[r][a];if(e.src.includes("blank"))n++;else if(n>0){let s=o[r+n][a];e.style.transition="transform 0.3s cubic-bezier(0.33, 1, 0.68, 1)",e.style.transform=`translateY(${n*g}px)`,t.push(new Promise(i=>{e.addEventListener("transitionend",()=>{s.src=e.src,s.dataset.type=e.dataset.type,e.src="./assets/blank.png",e.dataset.type="blank",e.style.transition="",e.style.transform="",i()},{once:!0})}))}}}await Promise.all(t)}async function F(){let t=[];for(let n=0;n<p;n++)for(let r=0;r<f;r++)if(o[r][n].src.includes("blank")){let e=o[r][n],s=w();e.src=`./assets/${s}.png`,e.dataset.type=s;const i=-g*(f+1);e.style.transform=`translateY(${i}px)`,e.style.opacity="0",e.classList.add("drop-in-fast"),e.offsetHeight,e.style.transform="translateY(0px)",e.style.opacity="1",t.push(new Promise(d=>{const m=()=>{(e.style.transform!==""||e.style.opacity!=="1"||e.classList.contains("drop-in-fast"))&&console.log(`Animation failed for tile ${r}-${n} at ${new Date().toISOString()}`),e.style.transform="",e.style.opacity="1",e.classList.remove("drop-in-fast"),d()};e.addEventListener("animationend",m,{once:!0}),setTimeout(m,250)}))}await Promise.all(t);let a=!1;for(let n=0;n<p;n++)for(let r=0;r<f;r++)if(o[r][n].src.includes("blank")){let e=w();o[r][n].src=`./assets/${e}.png`,o[r][n].dataset.type=e,o[r][n].style.opacity="1",o[r][n].style.transform="",o[r][n].classList.remove("drop-in-fast"),a=!0,console.log(`Instant fill for tile ${r}-${n} at ${new Date().toISOString()}`)}a&&console.log("Final check filled remaining blanks at:",new Date().toISOString())}window.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("img").forEach(t=>{t.onerror=()=>{t.remove(),console.warn(`Removed missing image: ${t.src}`)}})});
